{
  "SaveName": "",
  "Date": "",
  "VersionNumber": "",
  "GameMode": "",
  "GameType": "",
  "GameComplexity": "",
  "Tags": [],
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "Table": "",
  "Sky": "",
  "Note": "",
  "TabStates": {},
  "LuaScript": "",
  "LuaScriptState": "",
  "XmlUI": "",
  "ObjectStates": [
    {
      "GUID": "731e05",
      "Name": "Custom_Model_Bag",
      "Transform": {
        "posX": -0.46238178,
        "posY": 1.01000047,
        "posZ": 3.064063,
        "rotX": 6.568618E-06,
        "rotY": 269.999969,
        "rotZ": 4.212941E-06,
        "scaleX": 1.4740448,
        "scaleY": 0.100000381,
        "scaleZ": 1.47404611
      },
      "Nickname": "Hearthkyn Salvagers tokens",
      "Description": "If errors pop up, just wait for few sec and try again",
      "GMNotes": "_HS_tokens_infi",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.0
      },
      "Tags": [
        "_Hearthkyn_Salvager"
      ],
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "Number": 0,
      "CustomMesh": {
        "MeshURL": "https://steamusercontent-a.akamaihd.net/ugc/1666858152071990826/9AD455F2CBAEC01B2CBCDDB8B6DC4CE48D14B545/",
        "DiffuseURL": "",
        "NormalURL": "",
        "ColliderURL": "",
        "Convex": true,
        "MaterialIndex": 0,
        "TypeIndex": 6,
        "CastShadows": true
      },
      "Bag": {
        "Order": 0
      },
      "LuaScript": "-- constants\r\nlocal BUTTON_SETUP = {\r\n  label=\"Setup\",\r\n  click_function=\"click_setup\", function_owner=self,\r\n  position={0,0.3,-2}, rotation={0,180,0},\r\n  height=350, width=800,\r\n  font_size=250, color={0,0,0}, font_color={1,1,1}\r\n}\r\nlocal BUTTON_SETUP_2 = {\r\n  label=\"Setup\",\r\n  click_function=\"click_setup\",\r\n  function_owner=self,\r\n  position={-1,0.5,0}, rotation={0,270,0},\r\n  height=350, width=800,\r\n  font_size=250, color={0,0,0}, font_color={1,1,1}\r\n}\r\nlocal BUTTON_RECALL = {\r\n  label=\"Recall\",\r\n  click_function=\"click_recall\", function_owner=self,\r\n  position={1,0,-1}, rotation={0,270,0},\r\n  height=350, width=800,\r\n  font_size=250, color={1,0,0}, font_color={1,1,1}\r\n}\r\nlocal BUTTON_PLACE = {\r\n  label=\"Place\",\r\n  click_function=\"click_place\",\r\n  function_owner=self,\r\n  position={1,0,1}, rotation={0,270,0},\r\n  height=350, width=800,\r\n  font_size=250, color={0.2,0.95,0}, font_color={0,0,0}\r\n}\r\nlocal BUTTON_CANCEL = {\r\n  label=\"Cancel\",\r\n  click_function=\"click_cancel\",\r\n  function_owner=self,\r\n  position={0,0.3,-2}, rotation={0,180,0},\r\n  height=350, width=1100,\r\n  font_size=250, color={0,0,0}, font_color={1,1,1}\r\n}\r\nlocal BUTTON_SUBMIT = {\r\n  label=\"Submit\",\r\n  click_function=\"click_submit\", function_owner=self,\r\n  position={0,0.3,-2.8}, rotation={0,180,0},\r\n  height=350, width=1100,\r\n  font_size=250, color={0,0,0}, font_color={1,1,1}\r\n}\r\nlocal BUTTON_RESET = {\r\n  label=\"Reset\",\r\n  click_function=\"click_reset\",\r\n  function_owner=self,\r\n  position={-2,0.3,0}, rotation={0,270,0},\r\n  height=350, width=800,\r\n  font_size=250, color={0,0,0}, font_color={1,1,1}\r\n}\r\n\r\n-- functional utils\r\nlocal function transmute(t, vfn, kfn)\r\n    local out = {}\r\n    local c = 1\r\n    for k,v in pairs(t) do\r\n        local value = vfn(v,c,t)\r\n        local key = kfn != nil and kfn(v,c,t) or k\r\n        if (value and key) then\r\n            out[key] = value\r\n        end\r\n        c = c + 1\r\n    end\r\n    return out\r\nend\r\n\r\nlocal function duplicateTable(oldTable)\r\n  local newTable = {}\r\n  for k, v in pairs(oldTable) do\r\n    newTable[k] = v\r\n  end\r\n  return newTable\r\nend\r\n\r\nlocal function round(num, dec)\r\n  local mult = 10^(dec or 0)\r\n  return math.floor(num * mult + 0.5) / mult\r\nend\r\n\r\n-- object utils\r\nlocal function setOutline(list, enabled)\r\n  local count = 0\r\n\r\n  if (next(list) == nil) then\r\n    return count\r\n  end\r\n\r\n  for guid in pairs(list) do\r\n    count = count + 1\r\n    local obj = getObjectFromGUID(guid)\r\n    if (obj ~= nil and enabled == false) then obj.highlightOff() end\r\n    if (obj ~= nil and enabled == true) then obj.highlightOn({1,1,1}) end\r\n  end\r\n\r\n  return count\r\nend\r\n\r\nlocal function readRotation()\r\n  local r1, r2, r3 = self.getRotation():get()\r\n  return round(r2)\r\nend\r\n\r\nlocal function changeButtons(variant)\r\n  self.clearButtons()\r\n\r\n  if(variant == 'before_setup') then\r\n    self.createButton(BUTTON_SETUP)\r\n  elseif (variant == 'in_setup') then\r\n    self.createButton(BUTTON_CANCEL)\r\n    self.createButton(BUTTON_SUBMIT)\r\n    self.createButton(BUTTON_RESET)\r\n  elseif (variant == 'done_setup') then\r\n    self.createButton(BUTTON_PLACE)\r\n    self.createButton(BUTTON_RECALL)\r\n    self.createButton(BUTTON_SETUP_2)\r\n  end\r\nend\r\n\r\nfunction compare_coords(p1, p2, rotation)\r\n  local deltaPos = {}\r\n  r = math.rad(rotation)\r\n\r\n  z = ((-p2.x * math.sin(r) + p2.z * math.cos(r)))\r\n  x = ((p2.x * math.cos(r) + p2.z * math.sin(r)))\r\n\r\n  deltaPos.x = (p1.x+x)\r\n  deltaPos.y = (p1.y+p2.y)\r\n  deltaPos.z = (p1.z+z)\r\n\r\n  return deltaPos\r\nend\r\n\r\n\r\n--state utils\r\nlocal function readList()\r\n  return transmute(\r\n    getObjectsWithTag(self.getGMNotes()),\r\n    function(obj)\r\n      local selfPos = self.getPosition()\r\n      local objPos = obj.getPosition()\r\n      local deltaPos = {}\r\n      deltaPos.x = (objPos.x-selfPos.x)\r\n      deltaPos.y = (objPos.y-selfPos.y)\r\n      deltaPos.z = (objPos.z-selfPos.z)\r\n      local pos, rot = deltaPos, obj.getRotation()\r\n\r\n      return {\r\n        pos={x=round(pos.x,4), y=round(pos.y,4), z=round(pos.z,4)},\r\n        rot={x=round(rot.x,4), y=round(rot.y,4), z=round(rot.z,4)},\r\n        lock=obj.getLock()\r\n      }\r\n    end,\r\n    function(obj)\r\n      return obj.guid\r\n    end\r\n  )\r\nend\r\n\r\n\r\nfunction updateSave()\r\n  local data_to_save = {[\"ml\"]=memoryList, [\"rr\"]=relativeRotation}\r\n  saved_data = JSON.encode(data_to_save)\r\n  self.script_state = saved_data\r\nend\r\n\r\nfunction onload(saved_data)\r\n  if saved_data ~= \"\" then\r\n    local loaded_data = JSON.decode(saved_data)\r\n    --Set up information off of loaded_data\r\n    memoryList = loaded_data.ml\r\n    relativeRotation = loaded_data.rr\r\n  else\r\n    --Set up information for if there is no saved saved data\r\n    memoryList = {}\r\n\r\n    relativeRotation = readRotation()\r\n  end\r\n\r\n  if next(memoryList) == nil then\r\n    changeButtons('before_setup')\r\n  else\r\n    changeButtons('done_setup')\r\n  end\r\nend\r\n\r\n-- handlers for buttons\r\nfunction click_setup()\r\n  local tagTarget = self.getGMNotes()\r\n\r\n  if (tagTarget == nil or tagTarget == '') then\r\n    broadcastToAll('please specify a tag to target in GM notes')\r\n    return\r\n  end\r\n\r\n  memoryListBackup = duplicateTable(memoryList)\r\n  memoryList = readList()\r\n\r\n  if (next(memoryList) == nil) then\r\n    broadcastToAll('The tag you specified yielded in 0 objects')\r\n    return\r\n  end\r\n\r\n  setOutline(memoryList, true)\r\n\r\n  relativeRotationBackup = relativeRotation\r\n  relativeRotation = readRotation()\r\n\r\n  changeButtons('in_setup')\r\nend\r\n\r\nfunction click_cancel()\r\n  setOutline(memoryList, false)\r\n\r\n  memoryList = memoryListBackup\r\n  relativeRotation = relativeRotationBackup\r\n\r\n  if next(memoryList) == nil then\r\n    changeButtons('before_setup')\r\n  else\r\n    changeButtons('done_setup')\r\n  end\r\n\r\n  broadcastToAll(\"Selection Canceled\", {1,1,1})\r\nend\r\n\r\nfunction click_submit()\r\n  memoryList = readList()\r\n  if (next(memoryList) == nil) then\r\n    broadcastToAll(\"You cannot submit without any selections.\", {0.75, 0.25, 0.25})\r\n  else\r\n    changeButtons('done_setup')\r\n\r\n    local count = setOutline(memoryList, false)\r\n    broadcastToAll(count..\" Objects Saved\", {1,1,1})\r\n\r\n    updateSave()\r\n  end\r\nend\r\n\r\nfunction click_reset()\r\n  setOutline(memoryList, false)\r\n  memoryList = {}\r\n\r\n  relativeRotation = readRotation()\r\n\r\n  changeButtons('before_setup')\r\n\r\n  broadcastToAll(\"Tool Reset\", {1,1,1})\r\n  updateSave()\r\nend\r\n\r\nfunction click_place()\r\n\r\n  local bagObjList = self.getObjects()\r\n  local currentRotation = readRotation()\r\n\r\n  local newMemoryList = {}\r\n  local printed = false\r\n  for guid, entry in pairs(memoryList) do\r\n    local obj = getObjectFromGUID(guid)\r\n    local selfPos = self.getPosition()\r\n    local rot = { x=entry.rot.x, y=entry.rot.y, z=entry.rot.z }\r\n    local rotationAdjustment = currentRotation - relativeRotation\r\n\r\n    rot.y = rot.y + rotationAdjustment\r\n    if (rot.y > 360) then\r\n      rot.y = rot.y - 360\r\n    elseif (rot.y < 0) then\r\n      rot.y = rot.y + 360\r\n    end\r\n\r\n    --If obj is out on the table, move it to the saved pos/rot\r\n    if obj ~= nil then\r\n      local deltaPos = compare_coords(selfPos, entry.pos, rotationAdjustment)\r\n      obj.setPosition(deltaPos)\r\n      obj.setRotation(rot)\r\n      obj.setLock(entry.lock)\r\n      newMemoryList[obj.guid] = memoryList[obj.guid]\r\n    else\r\n      --If obj is inside of the bag\r\n      for _, bagObj in ipairs(bagObjList) do\r\n\r\n        if bagObj.guid == guid then\r\n\r\n            local deltaPos = compare_coords(selfPos, entry.pos, rotationAdjustment)\r\n            local item = self.takeObject({\r\n              guid=guid,\r\n              position=deltaPos,\r\n              rotation=rot,\r\n              smooth=false\r\n            })\r\n\r\n            newItem = item.clone({\r\n              position=deltaPos,\r\n              rotation=rot,\r\n              smooth=false\r\n            })\r\n            item.destruct()\r\n\r\n            newItem.setLock(entry.lock)\r\n            newItem.setPosition(deltaPos)\r\n            newMemoryList[newItem.guid] = memoryList[guid]\r\n          break\r\n        end\r\n      end\r\n    end\r\n  end\r\n\r\n  memoryList = {}\r\n  for k,v in pairs(newMemoryList) do\r\n   memoryList[k] = v\r\n  end\r\n  broadcastToAll(\"Objects Placed\", {1,1,1})\r\nupdateSave()\r\nend\r\n\r\nfunction click_recall()\r\n  for guid, entry in pairs(memoryList) do\r\n    local obj = getObjectFromGUID(guid)\r\n    if obj ~= nil then\r\n      self.putObject(obj)\r\n    end\r\n  end\r\n  broadcastToAll(\"Objects Recalled\", {1,1,1})\r\nend",
      "LuaScriptState": "{\"ml\":{\"1ea50c\":{\"lock\":true,\"pos\":{\"x\":1.3204,\"y\":0.0213,\"z\":-2.8871},\"rot\":{\"x\":0,\"y\":270,\"z\":0}},\"306ac4\":{\"lock\":true,\"pos\":{\"x\":-0.0342,\"y\":0.0213,\"z\":-2.8871},\"rot\":{\"x\":0,\"y\":270,\"z\":0}},\"50c22b\":{\"lock\":true,\"pos\":{\"x\":-1.3888,\"y\":0.0213,\"z\":-2.8871},\"rot\":{\"x\":0,\"y\":270,\"z\":0}},\"539e19\":{\"lock\":true,\"pos\":{\"x\":1.8702,\"y\":0.0213,\"z\":-5.9627},\"rot\":{\"x\":0,\"y\":180.0017,\"z\":0}},\"59ef78\":{\"lock\":true,\"pos\":{\"x\":-2.5107,\"y\":0.0213,\"z\":-4.5026},\"rot\":{\"x\":0,\"y\":179.9828,\"z\":0}},\"5e9203\":{\"lock\":true,\"pos\":{\"x\":-1.9384,\"y\":0.0213,\"z\":-5.9627},\"rot\":{\"x\":0,\"y\":180.0161,\"z\":0}},\"681bec\":{\"lock\":true,\"pos\":{\"x\":0.6006,\"y\":0.0213,\"z\":-5.9627},\"rot\":{\"x\":0,\"y\":179.9843,\"z\":0}},\"74d802\":{\"lock\":true,\"pos\":{\"x\":-2.7434,\"y\":0.0213,\"z\":-2.8872},\"rot\":{\"x\":0,\"y\":269.9967,\"z\":0}},\"915d03\":{\"lock\":true,\"pos\":{\"x\":2.675,\"y\":0.0213,\"z\":-2.8871},\"rot\":{\"x\":0,\"y\":270,\"z\":0}},\"b98e72\":{\"lock\":true,\"pos\":{\"x\":1.3362,\"y\":0.0213,\"z\":-4.4858},\"rot\":{\"x\":0,\"y\":179.9906,\"z\":0}},\"c49b3a\":{\"lock\":true,\"pos\":{\"x\":-1.2029,\"y\":0.0213,\"z\":-4.4858},\"rot\":{\"x\":0,\"y\":179.983,\"z\":0}},\"ce9430\":{\"lock\":true,\"pos\":{\"x\":-0.6689,\"y\":0.0213,\"z\":-5.9627},\"rot\":{\"x\":0,\"y\":179.9917,\"z\":0}},\"eaf2a5\":{\"lock\":true,\"pos\":{\"x\":2.7458,\"y\":0.0213,\"z\":-4.4252},\"rot\":{\"x\":0,\"y\":179.9905,\"z\":0}}},\"rr\":270}",
      "XmlUI": "",
      "ChildObjects": [
        {
          "GUID": "e9de45",
          "Name": "Custom_Tile",
          "Transform": {
            "posX": -5.34597366E-10,
            "posY": -0.499997616,
            "posZ": 4.03564571E-10,
            "rotX": -2.21330993E-07,
            "rotY": 270.0,
            "rotZ": 1.5846806E-06,
            "scaleX": 0.5,
            "scaleY": 9.999962,
            "scaleZ": 0.5000005
          },
          "Nickname": "",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 1.0,
            "g": 1.0,
            "b": 1.0
          },
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": true,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "CustomImage": {
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/2501278490238757041/7AAB48349DC64437E2C8AD74C6EF94B8B5249AC8/",
            "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/2501278490238757041/7AAB48349DC64437E2C8AD74C6EF94B8B5249AC8/",
            "ImageScalar": 1.0,
            "WidthScale": 0.0,
            "CustomTile": {
              "Type": 0,
              "Thickness": 0.1,
              "Stackable": false,
              "Stretch": true
            }
          },
          "LuaScript": "",
          "LuaScriptState": "",
          "XmlUI": ""
        }
      ]
    }
  ]
}